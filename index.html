<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجري الذكي</title>
    
    <!-- استدعاء Tailwind CSS للتصميم -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ضبط الخطوط -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        /* إخفاء شريط التمرير ولكن السماح بالتمرير */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-white text-gray-900">
    <div id="root"></div>

    <!-- كود المشروع -->
    <script type="module">
        // 1. استدعاء مكتبة React و ReactDOM من الإنترنت
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

        // 2. استدعاء الأيقونات (Lucide)
        import { 
            ShoppingCart, Package, Truck, Mail, Phone, MapPin, 
            User, ChevronRight, X, CheckCircle, Plus, Edit, 
            Trash2, Settings, LogIn, LogOut, LayoutGrid, Tag,
            CreditCard, Info, Save, Lock, Search, Minus, AlertCircle,
            Star, ArrowUpDown, Filter, Eye, ChevronLeft, ListOrdered,
            Clock, Boxes, Upload, ImageIcon, Loader2
        } from 'https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0';

        // 3. استدعاء Firebase (تم تحديث الروابط لتعمل في المتصفح)
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, collection, doc, setDoc, getDoc, 
            onSnapshot, addDoc, updateDoc, deleteDoc, query,
            serverTimestamp 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { 
            getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // --- بيانات مشروعك الخاصة ---
        const firebaseConfig = {
            apiKey: "AIzaSyC6CsbNXxoYqfGhomIGHJrd9YFLnrVcit4",
            authDomain: "montagat.firebaseapp.com",
            projectId: "montagat",
            storageBucket: "montagat.firebasestorage.app",
            messagingSenderId: "35540500962",
            appId: "1:35540500962:web:90eb9c35b0ae2d3f50f9bb",
            measurementId: "G-9YRSD2PR8N"
        };

        // تهيئة الخدمات
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        const appId = "montagat-store-1"; 
        const FORMSPREE_ID = "mnjnerzz"; 

        // --- المكون الرئيسي (App) ---
        function App() {
            const [user, setUser] = useState(null);
            const [authError, setAuthError] = useState(null);
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [settings, setSettings] = useState({
                storeName: "متجري الذكي",
                about: "نوفر لك أفضل المنتجات المختارة بعناية لتناسب احتياجاتك اليومية.",
                phone: "+20 123 456 789",
                email: "support@store.com",
                address: "القاهرة، مصر",
                paymentMethods: "الدفع نقداً عند الاستلام",
                adminPassword: "admin",
                secretAccessCode: "admin-open"
            });
            
            const [loading, setLoading] = useState(true);
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [showCheckout, setShowCheckout] = useState(false);
            const [orderSubmitted, setOrderSubmitted] = useState(false);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [isAdminLoggedIn, setIsAdminLoggedIn] = useState(false);
            const [adminTab, setAdminTab] = useState("products"); 
            const [editingProduct, setEditingProduct] = useState(null);
            const [activeCategory, setActiveCategory] = useState("الكل");
            const [searchQuery, setSearchQuery] = useState("");
            const [sortBy, setSortBy] = useState("default");
            
            const [imagePreview, setImagePreview] = useState(null);
            const [imageBase64, setImageBase64] = useState(""); 

            // المصادقة
            useEffect(() => {
                if (!auth) {
                    setAuthError("فشل في تهيئة Firebase.");
                    setLoading(false);
                    return;
                }
                const initAuth = async () => {
                    try { 
                        await signInAnonymously(auth); 
                    } catch (e) { 
                        console.error("Auth Error", e);
                        setAuthError("خطأ في الاتصال بقاعدة البيانات.");
                        setLoading(false);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    if (u) setAuthError(null);
                });
                return () => unsubscribe();
            }, []);

            // جلب البيانات
            useEffect(() => {
                if (!user || !db) return;

                const unsubP = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'products'), (s) => {
                    setProducts(s.docs.map(d => ({ id: d.id, ...d.data() })));
                    setLoading(false);
                }, (error) => {
                    console.error("Firestore Error:", error);
                    setLoading(false);
                });

                const unsubO = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), (s) => {
                    setOrders(s.docs.map(d => ({ id: d.id, ...d.data() })).sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)));
                });

                const unsubS = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), (d) => {
                    if (d.exists()) setSettings(prev => ({ ...prev, ...d.data() }));
                });

                return () => { unsubP(); unsubO(); unsubS(); };
            }, [user]);

            // البوابة السرية
            useEffect(() => {
                if (searchQuery.trim() === settings.secretAccessCode) {
                    setSearchQuery(""); setIsAdminMode(true); 
                }
            }, [searchQuery, settings.secretAccessCode]);

            useEffect(() => {
                if (editingProduct) {
                    setImagePreview(null);
                    setImageBase64("");
                }
            }, [editingProduct]);

            const handleImageSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 800 * 1024) { 
                        alert("عذراً، حجم الصورة كبير جداً. يرجى اختيار صورة أصغر من 800 كيلوبايت.");
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setImagePreview(reader.result); 
                        setImageBase64(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const saveProduct = async (e) => {
                e.preventDefault();
                if (!db) return;
                const fd = new FormData(e.target);
                let finalImage = imageBase64 || editingProduct?.image || "";

                const data = {
                    name: fd.get('name'),
                    price: Number(fd.get('price')),
                    category: fd.get('category'),
                    description: fd.get('description'),
                    image: finalImage,
                    inStock: fd.get('inStock') === 'on',
                    timestamp: serverTimestamp()
                };

                try {
                    if (editingProduct?.id) {
                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', editingProduct.id), data);
                    } else {
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), data);
                    }
                    setEditingProduct(null);
                    setImageBase64("");
                } catch (err) {
                    console.error("Error saving:", err);
                    alert("حدث خطأ أثناء الحفظ.");
                }
            };

            const handleCheckout = async (e) => {
                e.preventDefault();
                if (!db) return;
                const fd = new FormData(e.target);
                
                const orderData = {
                    customerName: fd.get('name'),
                    customerPhone: fd.get('phone'),
                    customerAddress: fd.get('addr'),
                    items: cart.map(i => ({name: i.name, qty: i.qty})),
                    totalAmount: totalPrice,
                    timestamp: serverTimestamp(),
                    status: 'قيد المراجعة'
                };

                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), orderData);

                    fd.append("تفاصيل_الطلب", cart.map(i => `${i.name} (العدد: ${i.qty}) - السعر: ${i.price * i.qty} ج.م`).join('\n'));
                    fd.append("الإجمالي_الكلي", totalPrice + " ج.م");

                    await fetch(`https://formspree.io/f/${FORMSPREE_ID}`, {
                        method: 'POST',
                        body: fd,
                        headers: { 'Accept': 'application/json' }
                    });

                    setOrderSubmitted(true);
                } catch (err) {
                    console.error("Checkout Error:", err);
                    alert("حدث خطأ أثناء إرسال الطلب، يرجى المحاولة مرة أخرى.");
                }
            };

            const addToCart = (p) => {
                const ex = cart.find(i => i.id === p.id);
                if (ex) setCart(cart.map(i => i.id === p.id ? { ...i, qty: i.qty + 1 } : i));
                else setCart([...cart, { ...p, qty: 1 }]);
            };

            const categories = ["الكل", ...new Set(products.map(p => p.category))];
            const processedProducts = useMemo(() => {
                let result = products.filter(p => {
                    const productName = p.name ? String(p.name).toLowerCase() : "";
                    return (activeCategory === "الكل" || p.category === activeCategory) && productName.includes(searchQuery.toLowerCase());
                });
                if (sortBy === "priceLow") result.sort((a, b) => a.price - b.price);
                if (sortBy === "priceHigh") result.sort((a, b) => b.price - a.price);
                return result;
            }, [products, activeCategory, searchQuery, sortBy]);

            const totalPrice = cart.reduce((s, i) => s + (i.price * i.qty), 0);

            if (authError) return React.createElement('div', {className: "min-h-screen flex items-center justify-center p-8 text-center bg-red-50 text-red-800 font-bold"}, authError);
            if (loading) return React.createElement('div', {className: "h-screen flex items-center justify-center font-bold text-blue-600"}, "جاري الاتصال بقاعدة البيانات...");

            return (
                React.createElement("div", {className: "min-h-screen bg-white text-right selection:bg-blue-100", dir: "rtl"},
                    /* Navbar */
                    React.createElement("nav", {className: "sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-100 px-6 py-4 flex justify-between items-center shadow-sm"},
                        React.createElement("div", {className: "flex items-center gap-4"},
                            React.createElement("div", {className: "bg-blue-600 p-2 rounded-xl text-white cursor-pointer shadow-lg", onClick: () => setIsAdminMode(false)},
                                React.createElement(Package, {size: 24})
                            ),
                            React.createElement("h1", {className: "text-xl font-black text-gray-900"}, settings.storeName)
                        ),
                        React.createElement("div", {className: "flex items-center gap-4"},
                            isAdminLoggedIn && React.createElement("button", {onClick: () => setIsAdminMode(!isAdminMode), className: "p-2 text-orange-600 bg-orange-50 rounded-xl hover:bg-orange-100 transition-colors"},
                                React.createElement(Settings, {size: 20})
                            ),
                            React.createElement("button", {onClick: () => setIsCartOpen(true), className: "relative p-2 text-gray-900"},
                                React.createElement(ShoppingCart, {size: 24}),
                                cart.length > 0 && React.createElement("span", {className: "absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center border-2 border-white"}, cart.length)
                            )
                        )
                    ),

                    isAdminMode ? (
                        React.createElement("div", {className: "max-w-7xl mx-auto p-6 animate-fade-in"},
                            !isAdminLoggedIn ? (
                                React.createElement("div", {className: "max-w-md mx-auto mt-20 p-10 bg-white border rounded-[2.5rem] shadow-xl text-center"},
                                    React.createElement(Lock, {className: "mx-auto mb-6 text-blue-600", size: 48}),
                                    React.createElement("h2", {className: "text-2xl font-bold mb-6"}, "دخول المسؤول"),
                                    React.createElement("input", {
                                        type: "password", 
                                        placeholder: "كلمة المرور", 
                                        className: "w-full p-4 bg-gray-50 rounded-2xl mb-4 text-center font-black outline-none border-2 focus:border-blue-500",
                                        onKeyDown: (e) => e.key === 'Enter' && e.target.value === settings.adminPassword && setIsAdminLoggedIn(true)
                                    })
                                )
                            ) : (
                                React.createElement("div", {className: "flex flex-col md:flex-row gap-8"},
                                    React.createElement("div", {className: "w-full md:w-56 space-y-2"},
                                        React.createElement("button", {onClick: () => setAdminTab("products"), className: `w-full p-4 rounded-2xl text-right font-bold ${adminTab==='products'?'bg-blue-600 text-white':'hover:bg-gray-100'}`}, "المنتجات"),
                                        React.createElement("button", {onClick: () => setAdminTab("orders"), className: `w-full p-4 rounded-2xl text-right font-bold ${adminTab==='orders'?'bg-blue-600 text-white':'hover:bg-gray-100'}`}, "الطلبات"),
                                        React.createElement("button", {onClick: () => setAdminTab("settings"), className: `w-full p-4 rounded-2xl text-right font-bold ${adminTab==='settings'?'bg-blue-600 text-white':'hover:bg-gray-100'}`}, "الإعدادات"),
                                        React.createElement("button", {onClick: () => setIsAdminLoggedIn(false), className: "w-full p-4 text-red-500 font-bold hover:bg-red-50 rounded-2xl"}, "خروج")
                                    ),
                                    React.createElement("div", {className: "flex-grow bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100"},
                                        adminTab === 'products' && React.createElement("div", null,
                                            React.createElement("div", {className: "flex justify-between items-center mb-8"},
                                                React.createElement("h3", {className: "text-2xl font-black"}, "إدارة الكتالوج"),
                                                React.createElement("button", {onClick: () => setEditingProduct({}), className: "bg-green-600 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2"}, React.createElement(Plus, {size: 18}), " إضافة منتج")
                                            ),
                                            React.createElement("div", {className: "grid grid-cols-1 gap-4"},
                                                products.map(p => 
                                                    React.createElement("div", {key: p.id, className: "flex items-center gap-4 p-4 bg-gray-50 rounded-2xl border hover:border-blue-100"},
                                                        p.image ? React.createElement("img", {src: p.image, className: "w-16 h-16 rounded-xl object-cover shadow-sm"}) : React.createElement("div", {className: "w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center"}, React.createElement(ImageIcon, {className: "text-gray-400"})),
                                                        React.createElement("div", {className: "flex-grow font-black text-gray-800"}, p.name, " - ", React.createElement("span", {className: "text-blue-600"}, p.price, " ج.م")),
                                                        React.createElement("div", {className: "flex gap-2"},
                                                            React.createElement("button", {onClick: () => setEditingProduct(p), className: "p-2 text-blue-600 hover:bg-white rounded-lg"}, React.createElement(Edit, {size: 18})),
                                                            React.createElement("button", {onClick: () => {if(confirm('حذف؟')) deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', p.id))}, className: "p-2 text-red-500 hover:bg-white rounded-lg"}, React.createElement(Trash2, {size: 18}))
                                                        )
                                                    )
                                                )
                                            )
                                        ),
                                        adminTab === 'orders' && React.createElement("div", null,
                                            React.createElement("h3", {className: "text-2xl font-black mb-8"}, "طلبات العملاء"),
                                            React.createElement("div", {className: "space-y-4"},
                                                orders.map(order => 
                                                    React.createElement("div", {key: order.id, className: "border-2 border-gray-50 rounded-3xl p-6 hover:border-blue-100"},
                                                        React.createElement("div", {className: "flex justify-between items-start mb-4"},
                                                            React.createElement("div", null, React.createElement("h4", {className: "text-lg font-black"}, order.customerName), React.createElement("p", {className: "text-sm text-gray-400 font-bold"}, order.phone)),
                                                            React.createElement("span", {className: "bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-black"}, order.status)
                                                        ),
                                                        React.createElement("p", {className: "text-gray-600 text-sm mb-4 font-bold"}, order.address),
                                                        React.createElement("div", {className: "bg-gray-50 p-4 rounded-xl text-xs font-bold mb-4"},
                                                            order.items?.map((it, i) => React.createElement("div", {key: i, className: "flex justify-between border-b last:border-0 py-1"}, React.createElement("span", null, it.name), React.createElement("span", null, "x", it.qty)))
                                                        ),
                                                        React.createElement("div", {className: "flex justify-between items-center pt-2"},
                                                            React.createElement("span", {className: "text-xl font-black text-blue-600"}, order.totalAmount, " ج.م"),
                                                            React.createElement("div", {className: "flex gap-2"},
                                                                React.createElement("button", {onClick: () => updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', order.id), {status: 'تم التوصيل'}), className: "px-4 py-2 bg-green-600 text-white rounded-lg text-xs font-bold"}, "تم التوصيل"),
                                                                React.createElement("button", {onClick: () => deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', order.id)), className: "px-4 py-2 bg-red-50 text-red-500 rounded-lg text-xs font-bold"}, "حذف")
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        ),
                                        adminTab === 'settings' && React.createElement("form", {className: "space-y-6 max-w-xl", onSubmit: async (e) => {
                                            e.preventDefault();
                                            if (!db) return;
                                            const fd = new FormData(e.target);
                                            try {
                                                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), {
                                                    storeName: fd.get('sn'), adminPassword: fd.get('ap'), phone: fd.get('ph'), secretAccessCode: fd.get('sc'), about: fd.get('ab'), paymentMethods: settings.paymentMethods, email: settings.email
                                                });
                                                alert("تم حفظ الإعدادات بنجاح!");
                                            } catch (err) {
                                                console.error("Settings Error:", err);
                                                alert("حدث خطأ أثناء حفظ الإعدادات.");
                                            }
                                        }},
                                            React.createElement("div", {className: "grid grid-cols-1 md:grid-cols-2 gap-4"},
                                                React.createElement("input", {name: "sn", defaultValue: settings.storeName, className: "p-4 bg-gray-50 rounded-xl outline-none border", placeholder: "اسم المتجر"}),
                                                React.createElement("input", {name: "ph", defaultValue: settings.phone, className: "p-4 bg-gray-50 rounded-xl outline-none border", placeholder: "رقم الهاتف"})
                                            ),
                                            React.createElement("textarea", {name: "ab", defaultValue: settings.about, className: "w-full p-4 bg-gray-50 rounded-xl outline-none border", placeholder: "وصف المتجر", rows: "3"}),
                                            React.createElement("div", {className: "grid grid-cols-1 md:grid-cols-2 gap-4"},
                                                React.createElement("input", {name: "sc", defaultValue: settings.secretAccessCode, className: "p-4 bg-orange-50 text-orange-600 rounded-xl outline-none font-bold border border-orange-100", placeholder: "كود البحث السري"}),
                                                React.createElement("input", {name: "ap", defaultValue: settings.adminPassword, className: "p-4 bg-gray-50 rounded-xl outline-none border", placeholder: "كلمة سر الإدارة"})
                                            ),
                                            React.createElement("button", {className: "w-full py-5 bg-gray-900 text-white rounded-[1.5rem] font-black text-lg shadow-xl hover:bg-black transition-all"}, "تحديث بيانات المتجر")
                                        )
                                    )
                                )
                            )
                        )
                    ) : (
                        /* --- واجهة العميل --- */
                        React.createElement(React.Fragment, null,
                            React.createElement("header", {className: "bg-blue-600 text-white py-24 px-6 text-center relative overflow-hidden"},
                                React.createElement("h2", {className: "text-5xl md:text-7xl font-black mb-6 relative z-10 tracking-tighter"}, settings.storeName),
                                React.createElement("p", {className: "text-xl md:text-2xl opacity-90 max-w-3xl mx-auto font-bold relative z-10 leading-relaxed"}, settings.about)
                            ),

                            React.createElement("div", {className: "max-w-7xl mx-auto p-6"},
                                React.createElement("div", {className: "flex flex-col lg:flex-row justify-between items-center gap-6 mb-12"},
                                    React.createElement("div", {className: "flex gap-2 overflow-x-auto no-scrollbar w-full lg:w-auto"},
                                        categories.map(c => React.createElement("button", {key: c, onClick: () => setActiveCategory(c), className: `px-8 py-3 rounded-full font-black text-sm whitespace-nowrap transition-all ${activeCategory===c?'bg-blue-600 text-white shadow-xl shadow-blue-100':'bg-white text-gray-400 border border-gray-100 hover:bg-gray-50'}`}, c))
                                    ),
                                    React.createElement("div", {className: "hidden lg:flex items-center bg-gray-100 rounded-xl px-4 py-2 w-64 border border-transparent focus-within:bg-white focus-within:border-blue-200 transition-all"},
                                        React.createElement(Search, {size: 16, className: "text-gray-400 ml-2"}),
                                        React.createElement("input", {value: searchQuery, onChange: (e) => setSearchQuery(e.target.value), placeholder: "بحث...", className: "bg-transparent outline-none text-sm w-full font-bold"})
                                    )
                                ),

                                React.createElement("div", {className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8"},
                                    processedProducts.map((p, idx) => 
                                        React.createElement("div", {key: p.id, className: "bg-white border border-gray-50 rounded-[2.5rem] overflow-hidden hover:shadow-2xl transition-all duration-500 group flex flex-col animate-fade-in", style:{animationDelay: `${idx * 0.05}s`}},
                                            React.createElement("div", {className: "h-72 overflow-hidden cursor-pointer relative", onClick: () => setSelectedProduct(p)},
                                                p.image ? React.createElement("img", {src: p.image, className: "w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000", alt: p.name}) : React.createElement("div", {className: "w-full h-full bg-gray-100 flex items-center justify-center text-gray-300"}, React.createElement(ImageIcon, {size: 48})),
                                                React.createElement("div", {className: "absolute top-4 right-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest text-gray-600"}, p.category)
                                            ),
                                            React.createElement("div", {className: "p-8 flex-grow"},
                                                React.createElement("h3", {className: "text-xl font-black text-gray-900 mb-2 line-clamp-1"}, p.name),
                                                React.createElement("div", {className: "text-3xl font-black text-blue-600"}, p.price, " ج.م")
                                            ),
                                            React.createElement("div", {className: "p-6 pt-0"},
                                                React.createElement("button", {onClick: () => addToCart(p), className: "w-full py-4 bg-gray-900 text-white rounded-[1.25rem] font-black text-sm hover:bg-black transition-all flex items-center justify-center gap-3 shadow-lg active:scale-95"}, React.createElement(ShoppingCart, {size: 18}), " أضف للسلة")
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    /* --- المودالات --- */
                    
                    /* مودال إضافة/تعديل المنتج */
                    editingProduct && React.createElement("div", {className: "fixed inset-0 z-[300] bg-black/60 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in"},
                        React.createElement("form", {className: "bg-white p-8 rounded-[3rem] w-full max-w-md space-y-4 shadow-2xl relative", onSubmit: saveProduct},
                            React.createElement("button", {type: "button", onClick: () => setEditingProduct(null), className: "absolute left-6 top-6 p-2 bg-gray-100 rounded-full hover:text-red-500 transition-all"}, React.createElement(X, {size: 20})),
                            React.createElement("h3", {className: "text-2xl font-black mb-6 tracking-tight"}, "تفاصيل المنتج"),
                            React.createElement("div", {className: "grid grid-cols-1 gap-3"},
                                React.createElement("input", {name: "name", defaultValue: editingProduct.name, placeholder: "اسم المنتج", className: "w-full p-4 bg-gray-50 rounded-2xl outline-none border", required: true}),
                                React.createElement("input", {name: "category", defaultValue: editingProduct.category, placeholder: "القسم", className: "w-full p-4 bg-gray-50 rounded-2xl outline-none border", required: true}),
                                React.createElement("input", {name: "price", type: "number", defaultValue: editingProduct.price, placeholder: "السعر", className: "w-full p-4 bg-gray-50 rounded-2xl outline-none border", required: true})
                            ),
                            React.createElement("div", {className: "border-2 border-dashed border-gray-200 p-6 rounded-2xl text-center relative hover:border-blue-400 transition-all cursor-pointer overflow-hidden"},
                                React.createElement("input", {type: "file", name: "imageFile", className: "absolute inset-0 opacity-0 cursor-pointer z-10", accept: "image/*", onChange: handleImageSelect}),
                                React.createElement("div", {className: "text-gray-400"}, React.createElement(Upload, {className: "mx-auto mb-2"}), React.createElement("span", {className: "font-bold text-sm block"}, "اضغط لاختيار صورة (أقل من 800KB)")),
                                (imagePreview || editingProduct.image) && React.createElement("div", {className: "mt-4 relative"},
                                    React.createElement("img", {src: imagePreview || editingProduct.image, className: "w-24 h-24 rounded-xl mx-auto object-cover shadow-md border-2 border-white", alt: "Preview"})
                                )
                            ),
                            React.createElement("textarea", {name: "description", defaultValue: editingProduct.description, className: "w-full p-4 bg-gray-50 rounded-2xl outline-none border", placeholder: "وصف المنتج...", rows: "3"}),
                            React.createElement("div", {className: "flex items-center gap-3 p-4 bg-gray-50 rounded-2xl"},
                                React.createElement("span", {className: "text-sm font-bold text-gray-400"}, "متوفر في المخزن؟"),
                                React.createElement("input", {type: "checkbox", name: "inStock", defaultChecked: editingProduct.inStock, className: "w-5 h-5 accent-blue-600"})
                            ),
                            React.createElement("button", {type: "submit", className: "w-full py-5 bg-blue-600 text-white rounded-2xl font-black text-lg shadow-xl transition-all"}, "حفظ البيانات")
                        )
                    ),

                    /* مودال السلة */
                    isCartOpen && React.createElement("div", {className: "fixed inset-0 z-[200] bg-black/40 flex justify-end backdrop-blur-sm animate-fade-in"},
                        React.createElement("div", {className: "bg-white w-full max-w-md h-full p-8 shadow-2xl flex flex-col animate-slide-left"},
                            React.createElement("div", {className: "flex justify-between items-center mb-10"},
                                React.createElement("h2", {className: "text-3xl font-black flex items-center gap-4"}, React.createElement(ShoppingCart, {className: "text-blue-600"}), " سلتك"),
                                React.createElement("button", {onClick: () => setIsCartOpen(false), className: "p-2 hover:bg-gray-100 rounded-full"}, React.createElement(X, {size: 28}))
                            ),
                            React.createElement("div", {className: "flex-grow overflow-y-auto space-y-6"},
                                cart.length === 0 ? React.createElement("div", {className: "text-center py-20 text-gray-300 font-black"}, "السلة فارغة حالياً") : cart.map(item => 
                                    React.createElement("div", {key: item.id, className: "flex gap-4 items-center bg-gray-50 p-4 rounded-2xl relative"},
                                        item.image && React.createElement("img", {src: item.image, className: "w-16 h-16 rounded-xl object-cover"}),
                                        React.createElement("div", {className: "flex-grow font-black text-sm"},
                                            React.createElement("p", {className: "text-gray-900"}, item.name),
                                            React.createElement("p", {className: "text-blue-600"}, item.price, " ج.م × ", item.qty)
                                        ),
                                        React.createElement("button", {onClick: () => setCart(cart.filter(i => i.id !== item.id)), className: "text-red-400 p-2"}, React.createElement(Trash2, {size: 18}))
                                    )
                                )
                            ),
                            cart.length > 0 && React.createElement("div", {className: "border-t pt-8 mt-4"},
                                React.createElement("div", {className: "text-3xl font-black mb-6 flex justify-between"}, React.createElement("span", null, "الإجمالي:"), React.createElement("span", {className: "text-blue-600"}, totalPrice, " ج.م")),
                                React.createElement("button", {onClick: () => { setIsCartOpen(false); setShowCheckout(true); }, className: "w-full py-5 bg-gray-900 text-white rounded-[1.5rem] font-black text-2xl shadow-xl active:scale-95 transition-all"}, "إتمام الشراء")
                            )
                        )
                    ),

                    /* مودال إنهاء الشراء */
                    showCheckout && React.createElement("div", {className: "fixed inset-0 z-[300] bg-white p-8 overflow-y-auto animate-fade-in"},
                        React.createElement("div", {className: "max-w-xl mx-auto py-10"},
                            React.createElement("div", {className: "flex justify-between items-center mb-12"},
                                React.createElement("h2", {className: "text-4xl font-black tracking-tighter"}, "بيانات التوصيل"),
                                React.createElement("button", {onClick: () => setShowCheckout(false), className: "p-4 bg-gray-100 rounded-full"}, React.createElement(X, {size: 24}))
                            ),
                            !orderSubmitted ? (
                                React.createElement("form", {className: "space-y-6 text-right", onSubmit: handleCheckout},
                                    React.createElement("div", {className: "space-y-4"},
                                        React.createElement("input", {name: "name", placeholder: "الاسم الكامل", className: "w-full p-5 bg-gray-50 rounded-2xl font-black outline-none border-2 border-transparent focus:border-blue-500", required: true}),
                                        React.createElement("input", {name: "phone", placeholder: "رقم الهاتف", className: "w-full p-5 bg-gray-50 rounded-2xl font-black outline-none border-2 border-transparent focus:border-blue-500", required: true}),
                                        React.createElement("textarea", {name: "addr", placeholder: "العنوان بالتفصيل", className: "w-full p-5 bg-gray-50 rounded-2xl font-black outline-none border-2 border-transparent focus:border-blue-500", rows: "3", required: true})
                                    ),
                                    React.createElement("div", {className: "bg-blue-50 p-8 rounded-[2rem] border-2 border-blue-100 flex items-center justify-between"},
                                        React.createElement("div", {className: "font-black text-right"}, React.createElement("p", {className: "text-blue-600 text-lg mb-1 font-black"}, "طريقة الدفع"), React.createElement("p", {className: "text-gray-500 font-bold"}, settings.paymentMethods)),
                                        React.createElement(CreditCard, {size: 48, className: "text-blue-200"})
                                    ),
                                    React.createElement("button", {className: "w-full py-7 bg-blue-600 text-white rounded-[2rem] font-black text-3xl shadow-2xl active:scale-95 transition-all"}, "تأكيد الطلب")
                                )
                            ) : (
                                React.createElement("div", {className: "text-center py-20 animate-fade-in"},
                                    React.createElement(CheckCircle, {className: "mx-auto text-green-500 mb-10", size: 100}),
                                    React.createElement("h2", {className: "text-6xl font-black mb-6"}, "تم استلام طلبك!"),
                                    React.createElement("p", {className: "text-gray-400 font-bold text-xl mb-12 leading-relaxed"}, "شكراً لثقتك بنا. سنتواصل معك هاتفياً في أقرب وقت ممكن لتأكيد الشحن."),
                                    React.createElement("button", {onClick: () => { setCart([]); setShowCheckout(false); setOrderSubmitted(false); }, className: "bg-gray-900 text-white px-20 py-6 rounded-[2rem] font-black text-2xl shadow-2xl active:scale-95 transition-all"}, "العودة للمتجر")
                                )
                            )
                        )
                    ),

                    /* تفاصيل المنتج */
                    selectedProduct && React.createElement("div", {className: "fixed inset-0 z-[200] bg-black/80 backdrop-blur-xl flex items-center justify-center p-4"},
                        React.createElement("div", {className: "bg-white rounded-[3.5rem] max-w-5xl w-full max-h-[90vh] overflow-y-auto relative animate-scale-up"},
                            React.createElement("button", {onClick: () => setSelectedProduct(null), className: "absolute left-8 top-8 z-10 p-3 bg-gray-100 rounded-full hover:text-red-500 transition-all shadow-sm"}, React.createElement(X, {size: 24})),
                            React.createElement("div", {className: "flex flex-col md:flex-row"},
                                React.createElement("div", {className: "md:w-1/2 p-12 bg-gray-50 flex items-center justify-center"}, selectedProduct.image ? React.createElement("img", {src: selectedProduct.image, className: "max-w-full rounded-[3rem] shadow-2xl"}) : React.createElement(ImageIcon, {size: 64, className: "text-gray-300"})),
                                React.createElement("div", {className: "md:w-1/2 p-12 md:p-20 flex flex-col justify-center text-right"},
                                    React.createElement("span", {className: "text-blue-600 font-black text-xs uppercase tracking-widest mb-4"}, selectedProduct.category),
                                    React.createElement("h2", {className: "text-4xl md:text-5xl font-black text-gray-900 mb-6"}, selectedProduct.name),
                                    React.createElement("div", {className: "text-4xl md:text-5xl font-black text-blue-600 mb-10"}, selectedProduct.price, " ج.م"),
                                    React.createElement("p", {className: "text-gray-500 text-lg leading-relaxed mb-10 font-bold"}, selectedProduct.description),
                                    React.createElement("button", {onClick: () => { addToCart(selectedProduct); setSelectedProduct(null); setIsCartOpen(true); }, className: "w-full py-6 bg-blue-600 text-white rounded-[2rem] font-black text-3xl shadow-2xl flex items-center justify-center gap-4 active:scale-95 transition-all"}, React.createElement(ShoppingCart, {size: 28}), " اطلبه الآن")
                                )
                            )
                        )
                    ),

                    /* Footer */
                    React.createElement("footer", {className: "bg-white border-t border-gray-100 py-20 mt-20 text-center md:text-right"},
                        React.createElement("div", {className: "max-w-7xl mx-auto px-8 grid grid-cols-1 md:grid-cols-3 gap-12"},
                            React.createElement("div", {className: "space-y-4 text-right"},
                                React.createElement("h4", {className: "text-2xl font-black text-blue-600"}, settings.storeName),
                                React.createElement("p", {className: "text-gray-400 font-bold leading-relaxed"}, settings.about)
                            ),
                            React.createElement("div", {className: "space-y-4"},
                                React.createElement("h4", {className: "text-xl font-black"}, "تواصل معنا"),
                                React.createElement("div", {className: "space-y-2 font-bold text-gray-600"},
                                    React.createElement("p", {className: "flex items-center justify-center md:justify-start gap-2"}, React.createElement(Phone, {size: 16}), " ", settings.phone),
                                    React.createElement("p", {className: "flex items-center justify-center md:justify-start gap-2"}, React.createElement(Mail, {size: 16}), " ", settings.email)
                                )
                            ),
                            React.createElement("div", {className: "space-y-4"},
                                React.createElement("h4", {className: "text-xl font-black"}, "طرق الشحن والدفع"),
                                React.createElement("p", {className: "font-bold text-blue-600"}, settings.paymentMethods),
                                React.createElement("div", {className: "flex justify-center md:justify-start gap-4 text-gray-300 mt-4"}, React.createElement(CreditCard, {size: 32}), React.createElement(Truck, {size: 32}))
                            )
                        ),
                        React.createElement("div", {className: "text-center mt-20 text-gray-300 font-bold text-[10px] tracking-widest uppercase border-t pt-8 mx-8"}, "© ", new Date().getFullYear(), " ", settings.storeName, " - جميع الحقوق محفوظة")
                    ),

                    /* أنيميشن */
                    React.createElement("style", {dangerouslySetInnerHTML: { __html: `
                        @keyframes slide-left { from { transform: translateX(100%); } to { transform: translateX(0); } }
                        .animate-slide-left { animation: slide-left 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
                        @keyframes scale-up { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
                        .animate-scale-up { animation: scale-up 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
                        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                        .animate-fade-in { animation: fade-in 0.8s ease-out forwards; }
                    ` }})
                )
            );
        }

        // تشغيل التطبيق
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>